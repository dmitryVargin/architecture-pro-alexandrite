# Планирование: анализ, идентификация проблем и поиск решений

## 1. Анализ и идентификация проблем

На основе предоставленной схемы и описания системы я выделил следующие критические проблемные зоны:

### Технологические и архитектурные проблемы

*   **Узкое горлышко (Bottleneck) в MES:** Расчет стоимости занимает от 2 до 30 минут и выполняется, вероятно, в рамках основного процесса. При росте заказов через API система не справляется с объемом, выстраивается огромная очередь.
*   **Конкуренция за ресурсы БД:** Одиночный инстанс базы данных MES db обслуживает и тяжелые расчеты, и запросы операторов. Это причина тормозов дашборда.
*   **Отсутствие наблюдаемости (Observability):** Заказы «теряются». Это сигнализирует о том, что в системе нет сквозного логирования (Tracing) и мониторинга очередей. Мы не знаем, на каком этапе «завис» заказ.
*   **Точка отказа (SPOF):** Использование одиночных инстансов EC2 и БД без реплик и Master-Slave конфигураций делает систему крайне уязвимой.
*   **Проблемы интеграции через RabbitMQ:** Судя по потере заказов, не настроены механизмы подтверждения (Acknowledgements), очереди с письмами-откатами (DLQ) или идемпотентность обработчиков.

### Процессные проблемы

*   **Медленный Time-to-Market:** Ручное E2E-тестирование и блокировка релизов из-за багов мешают оперативно исправлять критические ошибки в проде.
*   **Риски компетенций:** На самом критичном узле (MES, C#) работает всего один разработчик. Его отсутствие полностью парализует развитие этого сервиса.

## 2. Список инициатив по устранению проблем

Для решения выявленных проблем предлагаются следующие инициативы:

1.  **Внедрение Worker-паттерна для MES:** Вынос логики расчетов из API в отдельные масштабируемые воркеры.
2.  **Внедрение Read-реплик для БД:** Разделение потоков записи (расчеты) и чтения (дашборды операторов).
3.  **Внедрение системы распределенного трассирования (например, Jaeger/OpenTelemetry):** Чтобы видеть путь каждого заказа от «Корзины» до «Отгрузки».
4.  **Настройка надежности очередей:** Внедрение DLQ (Dead Letter Queues), системы повторных попыток (Retries) и мониторинга длины очередей в RabbitMQ.
5.  **Автоматизация тестирования (API & Integration):** Позволит сократить время ручного тестирования и ускорить релизный цикл.
6.  **Внедрение Health-checks и автоматического масштабирования (ASG):** Чтобы система сама поднимала новые инстансы при росте нагрузки.
7.  **Оптимизация БД MES:** Создание индексов и переписывание тяжелых запросов для дашборда.

## 3. Приоритизация инициатив

Порядок реализации (от самого срочного):

1.  **Асинхронные воркеры и масштабирование MES:** Это «пожар», который мешает бизнесу зарабатывать. Нужно разблокировать расчеты.
2.  **Наблюдаемость (Tracing) и надежность очередей:** Чтобы перестать терять заказы и репутацию перед крупными партнерами.
3.  **Read-реплики и оптимизация индексов:** Чтобы вернуть работоспособность операторам (внутренним клиентам).
4.  **Автоматизация тестирования и CI/CD:** Для стабилизации процесса выпуска исправлений.
5.  **Инфраструктурная отказоустойчивость (HA):** Когда поток стабилизирован, нужно обеспечить его 99.9% доступность.

## 4. Ответы на вопросы

### Какой вы видите целевую архитектуру через полгода?

Через 6 месяцев архитектура должна стать событийно-ориентированной и отказоустойчивой:

*   **MES** разделен на API-шлюз и кластер воркеров, которые масштабируются горизонтально в зависимости от нагрузки в RabbitMQ.
*   **Базы данных** работают в режиме высокой доступности (Multi-AZ) с выделенными репликами на чтение.
*   **Мониторинг:** Внедрен Dashboards (Grafana), где в реальном времени видно количество заказов в каждом статусе. При задержке расчета более 1 часа срабатывает Alert.
*   **Интеграция:** API для партнеров имеет Rate Limiting, чтобы внешние клиенты не могли «положить» систему шквалом запросов.
*   **Процессы:** Релизы выходят раз в неделю, критические баги покрыты автотестами на уровне API.

### Если бы у вас была возможность выполнить только три пункта в ближайшие полгода, что бы вы выбрали и почему?

Если ресурсы ограничены, я выберу те задачи, которые напрямую влияют на выживание бизнеса:

1.  **Масштабируемые воркеры для расчета в MES:** Это устраняет главную причину задержек (с 3 недель до нормативных 30 минут). Без этого все остальные улучшения бессмысленны, так как заказы будут продолжать копиться.
2.  **Распределенное трассирование и мониторинг очередей:** Мы должны немедленно перестать «терять» заказы. Бизнес должен видеть, где затык. Это позволит службе поддержки отвечать клиентам аргументированно, а разработчикам — быстро находить ошибки интеграции.
3.  **Внедрение Read-реплик и оптимизация БД MES:** Операторы — это те, кто приносит деньги, выпуская изделия. Если их инструмент (дашборд) не работает, производство стоит, даже если расчет цены прошел быстро. Это дешевое в реализации решение с огромным эффектом на производительность сотрудников.
